// filepath: packages/payments/prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Payment {
  id          String   @id @default(uuid()) @db.Uuid
  orderId     String   @db.Text  // Reference to orders service
  amount      Decimal  @db.Decimal(12, 2)
  currency    String   @default("BRL") @db.Char(3)
  status      String   @default("pending") @db.Text  // pending, completed, failed, refunded
  paymentMethod String @db.Text  // e.g., card, pix
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamp
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp

  transactions Transaction[]
}

model Transaction {
  id         String   @id @default(uuid()) @db.Uuid
  paymentId  String   @map("payment_id") @db.Uuid
  gatewayId  String   @db.Text  // Payment simulator transaction ID
  amount     Decimal  @db.Decimal(12, 2)
  status     String   @db.Text
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamp

  payment Payment @relation(fields: [paymentId], references: [id], onDelete: Cascade)
}
